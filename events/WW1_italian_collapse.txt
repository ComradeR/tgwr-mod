add_namespace = garibaldi

#Victor Emmannuel abdicates
country_event = {
	id = garibaldi.1
	title = garibaldi.1.t
	desc = garibaldi.1.d
	fire_only_once = yes
	mean_time_to_happen = {
		days = 14
	}
	trigger = {
		tag = ITA
		has_country_flag = great_war_loser
		OR = {
			has_global_flag = versallies_treaty
			has_global_flag = frankfurt_treaty
		}
	}
	option = {
		name = garibaldi.1.a
		retire_ideology_leader = neutrality
		create_country_leader = { 
			name = "Prince Umberto"
			#picture = "gfx/leaders/ITA/ITA_prince_umberto.dds"
			expire="1935.1.1" 
			ideology = autocracy
			traits = {} 
		}
		hidden_effect = {
			remove_ideas = victor_emmanuel
			news_event = { id = garibaldi.2 hours = 1 }
			country_event = { id = garibaldi.4 days = 15}
		}
	}
}
#Victor abdication news event
news_event = {
	id = garibaldi.2
	title = garibaldi.2.t
	desc = garibaldi.2.d
	picture = GFX_news_event_saf_civil_war
	major = yes
	is_triggered_only = yes
	option = {
		name = garibaldi.2.a
	}
}
#Southern Monarchists declare restoration of the monarchy
country_event = {
	id = garibaldi.3
	title = garibaldi.3.t
	desc = garibaldi.3.d
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			115 = {
				set_demilitarized_zone = yes
			}
			117 = {
				set_demilitarized_zone = yes
			}
			156 = {
				set_demilitarized_zone = yes
			}
			157 = {
				set_demilitarized_zone = yes
			}
		}
	}
	option = {
		name = garibaldi.3.a
		add_stability = -0.1
		hidden_effect = {
			country_event = { id = garibaldi.6 days = 7 }
		}
	}
}
#Socialists declare Italian Commune
country_event = {
	id = garibaldi.4
	title = garibaldi.4.t
	desc = garibaldi.4.d
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			2 = {
				set_demilitarized_zone = yes
			}
			158 = {
				set_demilitarized_zone = yes
			}
			159 = {
				set_demilitarized_zone = yes
			}
			161 = {
				set_demilitarized_zone = yes
			}
			162 = {
				set_demilitarized_zone = yes
			}
			834 = {
				set_demilitarized_zone = yes
			}

			add_popularity = { ideology = communism popularity = 0.2 }
		}
	}
	option = {
		name = garibaldi.4.a
		add_stability = -0.05
		hidden_effect = { country_event = { id = garibaldi.5 days = 3 } }
	}
}
#Republican uprising
country_event = {
	id = garibaldi.5
	title = garibaldi.5.t
	desc = garibaldi.5.d
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			ITA = {
				set_politics = {
					ruling_party = democratic
				}
				add_popularity = { ideology = democratic popularity = 0.35 }
			}
		}		
	}	
	option = {
		name = garibaldi.5.a
		add_stability = -0.01
		hidden_effect = { country_event = { id = garibaldi.3 days = 2 } }
	}
}
#Italy fragments
country_event = {
	id = garibaldi.6
	title = garibaldi.6.t
	desc = garibaldi.6.d
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		hidden_effect = {
			ITA = {
				set_capital = 161
			}
			115 = {
				set_demilitarized_zone = no
			}
			117 = {
				set_demilitarized_zone = no
			}
			156 = {
				set_demilitarized_zone = no
			}
			157 = {
				set_demilitarized_zone = no
			}

			SIC = {
				transfer_state = 114
				transfer_state = 115
				transfer_state = 117
				transfer_state = 156
				transfer_state = 157
				transfer_state = 835

				set_rule = { can_join_factions = no }
				leave_faction = yes

				inherit_technology = ITA
			}

			ITA = {
				transfer_units_fraction= {
					target = SIC
					size = 0.4
					stockpile_ratio = 0.4
					army_ratio = 0.45
					navy_ratio = 0.5
					air_ratio = 0.35
				}
			}

			SRD = {
				transfer_state = 114

				set_rule = { can_join_factions = no }
				leave_faction = yes

				inherit_technology = ITA

				set_cosmetic_tag = ITA_democratic
			}

			ITA = {
				transfer_units_fraction= {
					target = SRD
					size = 0.4
					stockpile_ratio = 0.2
					army_ratio = 0.3
					navy_ratio = 0.6
					air_ratio = 0.4
				}
			}

			2 = {
				set_demilitarized_zone = no
			}
			158 = {
				set_demilitarized_zone = no
			}
			159 = {
				set_demilitarized_zone = no
			}
			161 = {
				set_demilitarized_zone = no
			}
			162 = {
				set_demilitarized_zone = no
			}
			834 = {
				set_demilitarized_zone = no
			}

			ITA = {
				if = {
					limit = {
						NOT = {
							has_completed_focus = ITA_vittoria_mutilata
						}
					}
					complete_national_focus = ITA_vittoria_mutilata
				}
				if = {
					limit = {
						NOT = {
							OR = {
								has_completed_focus = ITA_fascismo_movimento
								has_completed_focus = ITA_support_socialist_movenment
							}
						}
					}
					complete_national_focus = ITA_support_socialist_movenment
				}

				set_politics = {
					ruling_party = communism
				}
				add_popularity = { ideology = communism popularity = 0.5 }
				set_cosmetic_tag = ITA_communism
			}

			every_state = {
				limit = { is_core_of = ITA }
				add_core_of = SRD
				add_core_of = SIC
			}

			news_event = { id = garibaldi.7 hours = 1 }
			every_state = {
				limit = {
					is_core_of = LBA
					is_owned_by = ITA
				}
				LBA = {
					transfer_state = PREV
				}					
			}
			every_state = {
				limit = {
					is_core_of = SOM
					is_owned_by = ITA
				}
				SOM = {
					transfer_state = PREV
				}
			}
			if = {
				limit = {
					ETH = { exists = yes has_war = no NOT = {has_country_flag = great_war_loser}}		
				}	
				every_state = {
					limit = {
						is_core_of = ERI
						is_owned_by = ITA
					}
					ETH = {
						transfer_state = PREV
					}
				}
				else = {
					every_state = {
						limit = {
							is_core_of = ERI
							is_owned_by = ITA
						}
						ERI = {
							transfer_state = PREV
						}
					}
				}	
			}
		}
	}
	#stay as communists
	option = {
		name = garibaldi.6.a
		ai_chance = { factor = 100 }
		ITA = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SRD = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SIC = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
	}
	#Viva Italia
	option = {
		name = garibaldi.6.b
		ai_chance = { factor = 0 }
		ITA = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SRD = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SIC = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SRD = { change_tag_from = ROOT }
	}
	#Two Siclies
	option = {
		name = garibaldi.6.c
		ai_chance = { factor = 0 }
		ITA = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SRD = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SIC = {
			every_state = {
				hidden_effect = {
					teleport_armies = {
						to_state_array = owned_controlled_states
					}
				}
			}
		}
		SIC = { change_tag_from = ROOT }
	}
}
#Italy fragmentation news event
news_event = {
	id = garibaldi.7
	title = garibaldi.7.t
	desc = garibaldi.7.d
	is_triggered_only = yes
	picture = GFX_news_event_fascist_militia
	major = yes
	option = {
		name = garibaldi.7.a
	}
}